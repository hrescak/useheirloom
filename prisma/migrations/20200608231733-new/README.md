# Migration `20200608231733-new`

This migration has been generated by Matej Hrescak at 6/8/2020, 11:17:33 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Unit" AS ENUM ('TSP', 'TBSP', 'CUP', 'MG', 'G', 'KG', 'OZ', 'FLOZ');

CREATE TYPE "CategoryType" AS ENUM ('CUSTOM', 'MEAL', 'CUISINE', 'DISH_TYPE', 'CONSIDERATION', 'OCCASION', 'PREPARATION', 'SEASON');

CREATE TABLE "public"."User" (
"avatarUrl" text   ,"email" text  NOT NULL ,"googleId" integer   ,"hash" text  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,"salt" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Kitchen" (
"description" text   ,"id" SERIAL,"name" text  NOT NULL ,"ownerId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Recipe" (
"cookDuration" integer   ,"id" SERIAL,"imageURL" text   ,"ingredientSections" text []  ,"instructions" text   ,"isDeleted" boolean  NOT NULL DEFAULT false,"kitchenId" integer  NOT NULL ,"name" text   ,"prepDuration" integer   ,"publicID" text   ,"servings" integer   ,"sourceName" text   ,"sourceURL" text   ,"summary" text   ,"totalDuration" integer   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Ingredient" (
"category" text  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."RecipeIngredient" (
"freeform" text  NOT NULL ,"id" SERIAL,"ingredientId" integer   ,"priority" Decimal(65,30)  NOT NULL ,"quantity" Decimal(65,30)   ,"recipeId" integer  NOT NULL ,"section" integer   ,"unit" "Unit"  ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Category" (
"description" text  NOT NULL ,"id" SERIAL,"kitchenId" integer  NOT NULL ,"name" text  NOT NULL ,"recipeId" integer   ,"type" "CategoryType" NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_KitchenToUser" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

CREATE TABLE "public"."_RecipeToUser" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "User.googleId" ON "public"."User"("googleId")

CREATE UNIQUE INDEX "Kitchen_ownerId" ON "public"."Kitchen"("ownerId")

CREATE UNIQUE INDEX "Recipe.publicID" ON "public"."Recipe"("publicID")

CREATE UNIQUE INDEX "_KitchenToUser_AB_unique" ON "public"."_KitchenToUser"("A","B")

CREATE  INDEX "_KitchenToUser_B_index" ON "public"."_KitchenToUser"("B")

CREATE UNIQUE INDEX "_RecipeToUser_AB_unique" ON "public"."_RecipeToUser"("A","B")

CREATE  INDEX "_RecipeToUser_B_index" ON "public"."_RecipeToUser"("B")

ALTER TABLE "public"."Kitchen" ADD FOREIGN KEY ("ownerId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Recipe" ADD FOREIGN KEY ("kitchenId")REFERENCES "public"."Kitchen"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."RecipeIngredient" ADD FOREIGN KEY ("ingredientId")REFERENCES "public"."Ingredient"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."RecipeIngredient" ADD FOREIGN KEY ("recipeId")REFERENCES "public"."Recipe"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Category" ADD FOREIGN KEY ("kitchenId")REFERENCES "public"."Kitchen"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Category" ADD FOREIGN KEY ("recipeId")REFERENCES "public"."Recipe"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."_KitchenToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Kitchen"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_KitchenToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_RecipeToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Recipe"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_RecipeToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200608231733-new
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,106 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+enum Unit {
+  TSP
+  TBSP
+  CUP
+  MG
+  G
+  KG
+  OZ
+  FLOZ
+}
+
+enum CategoryType {
+  CUSTOM
+  MEAL
+  CUISINE
+  DISH_TYPE
+  CONSIDERATION
+  OCCASION
+  PREPARATION
+  SEASON
+}
+
+model User {
+  id             Int       @default(autoincrement()) @id
+  email          String    @unique
+  name           String
+  googleId       Int?      @unique
+  avatarUrl      String?
+  hash           String
+  salt           String
+  ownKitchen     Kitchen   @relation("KitchenOwnership")
+  kitchens       Kitchen[] @relation(references: [id])
+  starredRecipes Recipe[]
+}
+
+model Kitchen {
+  id          Int        @default(autoincrement()) @id
+  name        String
+  description String?
+  owner       User       @relation("KitchenOwnership", references: [id], fields: [ownerId])
+  ownerId     Int
+  users       User[]     @relation(references: [id])
+  recipes     Recipe[]
+  categories  Category[]
+}
+
+model Recipe {
+  id                 Int      @default(autoincrement()) @id
+  name               String?
+  summary            String?
+  publicID           String?   @unique
+  sourceName         String?
+  sourceURL          String?
+  servings           Int?
+  prepDuration       Int?
+  cookDuration       Int?
+  totalDuration      Int?
+  kitchen            Kitchen  @relation(references: [id], fields: [kitchenId])
+  kitchenId          Int
+  imageURL           String?
+  ingredients  RecipeIngredient[]
+  ingredientSections String[]
+  instructions       String?
+  isDeleted          Boolean  @default(value: false)
+  categories   Category[] 
+  starredBy          User[]
+
+}
+
+model Ingredient {
+  id       Int                @default(autoincrement()) @id
+  name     String
+  category String
+  uses     RecipeIngredient[]
+}
+
+model RecipeIngredient {
+  id           Int        @default(autoincrement()) @id
+  freeform     String
+  ingredient   Ingredient? @relation(references: [id], fields: [ingredientId])
+  ingredientId Int?
+  recipe       Recipe     @relation(references: [id], fields: [recipeId])
+  recipeId     Int
+  priority     Float
+  quantity     Float?
+  unit         Unit?
+  section      Int?
+}
+
+model Category {
+  id          Int          @default(autoincrement()) @id
+  name        String
+  description String
+  kitchen     Kitchen      @relation(references: [id], fields: [kitchenId])
+  kitchenId   Int
+  type        CategoryType
+}
```


