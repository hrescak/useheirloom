# Migration `20200720135528-ingredient-sections`

This migration has been generated by Matej Hrescak at 7/20/2020, 1:55:28 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."RecipeIngredientSection" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"name" text  NOT NULL ,"recipeId" integer  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Recipe" DROP COLUMN "ingredientSections",
ALTER COLUMN "authorId" DROP DEFAULT;

ALTER TABLE "public"."RecipeIngredient" DROP COLUMN "section",
ADD COLUMN "sectionId" integer   ;

ALTER TABLE "public"."RecipeIngredientSection" ADD FOREIGN KEY ("recipeId")REFERENCES "public"."Recipe"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."RecipeIngredient" ADD FOREIGN KEY ("sectionId")REFERENCES "public"."RecipeIngredientSection"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200714221908-updated-at-step-two..20200720135528-ingredient-sections
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 enum Unit {
   TSP
@@ -75,15 +75,15 @@
   kitchen            Kitchen            @relation(references: [id], fields: [kitchenId])
   kitchenId          Int
   imageURL           String?
   ingredients        RecipeIngredient[]
-  ingredientSections String[]
+  ingredientSections RecipeIngredientSection[]
   instructions       String?
   isDeleted          Boolean            @default(value: false)
   categories         Category[]
   starredBy          User[]
   author             User               @relation("RecipeOwnership", references: [id], fields: [authorId])
-  authorId           Int                @default(value: 1) //before manually going through everyone
+  authorId           Int
 }
 model Ingredient {
@@ -106,11 +106,23 @@
   recipeId     Int
   priority     Float
   quantity     Float?
   unit         Unit?
-  section      Int?
+  section      RecipeIngredientSection? @relation(references:[id], fields:[sectionId])
+  sectionId    Int?
 }
+model RecipeIngredientSection {
+  id           Int         @default(autoincrement()) @id
+  createdAt    DateTime    @default(now())
+  updatedAt    DateTime    @updatedAt
+  name         String
+  ingredients  RecipeIngredient[]
+  recipe       Recipe @relation(references:[id], fields:[recipeId])
+  recipeId     Int
+
+}
+
 model Category {
   id          Int          @default(autoincrement()) @id
   createdAt   DateTime     @default(now())
   updatedAt   DateTime     @updatedAt
```
