# Migration `20200601165451-allfields`

This migration has been generated by Matej Hrescak at 6/1/2020, 4:54:51 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Unit" AS ENUM ('TSP', 'TBSP', 'CUP', 'MG', 'G', 'KG', 'OZ', 'FLOZ');

CREATE TYPE "CategoryType" AS ENUM ('CUSTOM', 'MEAL', 'CUISINE', 'DISH_TYPE', 'CONSIDERATION', 'OCCASION', 'PREPARATION', 'SEASON');

CREATE TABLE "public"."Ingredient" (
"category" text  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Category" ADD COLUMN "authorId" integer  NOT NULL ,
ADD COLUMN "description" text  NOT NULL ,
ADD COLUMN "name" text  NOT NULL ,
ADD COLUMN "type" "CategoryType" NOT NULL ;

ALTER TABLE "public"."RecipeIngredient" ADD COLUMN "freeform" text  NOT NULL ,
ADD COLUMN "ingredientId" integer  NOT NULL ,
ADD COLUMN "priority" Decimal(65,30)  NOT NULL ,
ADD COLUMN "quantity" Decimal(65,30)  NOT NULL ,
ADD COLUMN "recipeId" integer  NOT NULL ,
ADD COLUMN "section" integer  NOT NULL ,
ADD COLUMN "unit" "Unit" NOT NULL ;

ALTER TABLE "public"."Category" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."RecipeIngredient" ADD FOREIGN KEY ("ingredientId")REFERENCES "public"."Ingredient"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."RecipeIngredient" ADD FOREIGN KEY ("recipeId")REFERENCES "public"."Recipe"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200601161803-create..20200601165451-allfields
--- datamodel.dml
+++ datamodel.dml
@@ -3,11 +3,33 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
+enum Unit {
+  TSP
+  TBSP
+  CUP
+  MG
+  G
+  KG
+  OZ
+  FLOZ
+}
+
+enum CategoryType {
+  CUSTOM
+  MEAL
+  CUISINE
+  DISH_TYPE
+  CONSIDERATION
+  OCCASION
+  PREPARATION
+  SEASON
+}
+
 model Post {
   id        Int     @default(autoincrement()) @id
   title     String
   content   String?
@@ -16,15 +38,16 @@
   authorId  Int?
 }
 model User {
-  id             Int       @default(autoincrement()) @id
-  email          String    @unique
+  id             Int        @default(autoincrement()) @id
+  email          String     @unique
   name           String?
   posts          Post[]
-  ownKitchen     Kitchen   @relation("KitchenOwnership")
-  kitchens       Kitchen[] @relation(references: [id])
+  ownKitchen     Kitchen    @relation("KitchenOwnership")
+  kitchens       Kitchen[]  @relation(references: [id])
   starredRecipes Recipe[]
+  Category       Category[]
 }
 model Kitchen {
   id          Int      @default(autoincrement()) @id
@@ -56,14 +79,35 @@
   isDeleted          Boolean  @default(value: false)
   //categories   Category[] @relation(references: [id])
   starredBy          User[]
+  RecipeIngredient RecipeIngredient[]
 }
+model Ingredient {
+  id       Int                @default(autoincrement()) @id
+  name     String
+  category String
+  uses     RecipeIngredient[]
+}
+
 model RecipeIngredient {
-  id Int @default(autoincrement()) @id
-
+  id           Int        @default(autoincrement()) @id
+  freeform     String
+  ingredient   Ingredient @relation(references: [id], fields: [ingredientId])
+  ingredientId Int
+  recipe       Recipe     @relation(references: [id], fields: [recipeId])
+  recipeId     Int
+  priority     Float
+  quantity     Float
+  unit         Unit
+  section      Int
 }
 model Category {
-  id Int @default(autoincrement()) @id
+  id          Int          @default(autoincrement()) @id
+  name        String
+  description String
+  author      User         @relation(references: [id], fields: [authorId])
+  authorId    Int
+  type        CategoryType
 }
```


